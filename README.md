# Zadnik Store

### Backend

- Go 1.22.1
- gRPC
- PostgreSQL
- RabbitMQ
- Docker

### Frontend

- HTML/CSS/JavaScript
- Go template

### Structure of project

```
zadnik.store/
â”œâ”€â”€ api/                    # gRPC API Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ñ Ğ¸ ÑĞ³ĞµĞ½ĞµÑ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¹ ĞºĞ¾Ğ´
â”œâ”€â”€ bin/                    # Ğ¡ĞºĞ¾Ğ¼Ğ¿Ğ¸Ğ»Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ±Ğ¸Ğ½Ğ°Ñ€Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
â”œâ”€â”€ cmd/                    # Ğ¢Ğ¾Ñ‡ĞºĞ¸ Ğ²Ñ…Ğ¾Ğ´Ğ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”œâ”€â”€ auth/               # ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
â”‚   â”œâ”€â”€ gateway/            # API Gateway
â”‚   â”œâ”€â”€ image/              # ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ğ¹
â”‚   â””â”€â”€ product/            # ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸Ñ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
â”œâ”€â”€ deployments/            # ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Ğ´Ğ»Ñ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ
â”œâ”€â”€ internal/               # Ğ’Ğ½ÑƒÑ‚Ñ€ĞµĞ½Ğ½ÑÑ Ğ»Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”œâ”€â”€ static/                 # Ğ¡Ğ¾Ğ±Ñ€Ğ°Ğ½Ğ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ĞºĞ°
â”‚   â”œâ”€â”€ admin/             # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ĞºĞ° Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
â”‚   â”‚   â”œâ”€â”€ css/          # Ğ¡Ñ‚Ğ¸Ğ»Ğ¸
â”‚   â”‚   â”œâ”€â”€ js/           # Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ images/       # Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ fonts/        # Ğ¨Ñ€Ğ¸Ñ„Ñ‚Ñ‹
â”‚   â”‚   â””â”€â”€ templates/    # HTML ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹
â”‚   â””â”€â”€ client/           # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¸
â”‚       â”œâ”€â”€ css/
â”‚       â”œâ”€â”€ js/
â”‚       â”œâ”€â”€ images/
â”‚       â”œâ”€â”€ fonts/
â”‚       â””â”€â”€ templates/
â”œâ”€â”€ public/                # ĞŸÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ğ°Ñ ÑÑ‚Ğ°Ñ‚Ğ¸ĞºĞ°
â”‚   â”œâ”€â”€ admin/             # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ĞºĞ° Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
â”‚   â”‚   â”œâ”€â”€ css/          # Ğ¡Ñ‚Ğ¸Ğ»Ğ¸
â”‚   â”‚   â”œâ”€â”€ js/           # Ğ¡ĞºÑ€Ğ¸Ğ¿Ñ‚Ñ‹
â”‚   â”‚   â”œâ”€â”€ images/       # Ğ˜Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â”‚   â”œâ”€â”€ fonts/        # Ğ¨Ñ€Ğ¸Ñ„Ñ‚Ñ‹
â”‚   â”‚   â””â”€â”€ templates/    # HTML ÑˆĞ°Ğ±Ğ»Ğ¾Ğ½Ñ‹
â”‚   â””â”€â”€ client/           # Ğ¡Ñ‚Ğ°Ñ‚Ğ¸ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¸
â”‚       â”œâ”€â”€ css/
â”‚       â”œâ”€â”€ js/
â”‚       â”œâ”€â”€ images/
â”‚       â”œâ”€â”€ fonts/
â”‚       â””â”€â”€ templates/
â”œâ”€â”€ logs/                  # Ğ›Ğ¾Ğ³Ğ¸ Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ñ
â”‚   â””â”€â”€ app.log           # Ğ¤Ğ°Ğ¹Ğ» Ğ»Ğ¾Ğ³Ğ¾Ğ²
â””â”€â”€ web/                   # Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ¸ĞºĞ¸ Ñ„Ñ€Ğ¾Ğ½Ñ‚ĞµĞ½Ğ´Ğ°
    â”œâ”€â”€ html-css-js-admin/ # Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ¸ĞºĞ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
    â”‚   â”œâ”€â”€ assets/       # Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹
    â”‚   â”‚   â”œâ”€â”€ fonts/
    â”‚   â”‚   â”œâ”€â”€ images/
    â”‚   â”‚   â”œâ”€â”€ scripts/
    â”‚   â”‚   â”œâ”€â”€ styles/
    â”‚   â”‚   â””â”€â”€ views/
    â”‚   â””â”€â”€ tasks/        # Gulp Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸
    â””â”€â”€ html-css-js-client/ # Ğ˜ÑÑ…Ğ¾Ğ´Ğ½Ğ¸ĞºĞ¸ ĞºĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¸
        â”œâ”€â”€ assets/
        â”‚   â”œâ”€â”€ fonts/
        â”‚   â”œâ”€â”€ images/
        â”‚   â”œâ”€â”€ scripts/
        â”‚   â”œâ”€â”€ styles/
        â”‚   â””â”€â”€ views/
        â””â”€â”€ tasks/
```

### Basic usage

```bash
$ migrate -source file://path/to/migrations -database postgres://localhost:5432/database up 2

### Requirements

- Go 1.22.1+
- Docker
- RabbitMQ
- PostgreSQL

### Frontend build
```bash
# Build admin panel
cd web/html-css-js-admin
npm install
npm run build  # Ğ¡Ğ¾Ğ±ĞµÑ€ĞµÑ‚ Ğ² static/admin/

# Ğ¡Ğ±Ğ¾Ñ€ĞºĞ° ĞºĞ»Ğ¸ĞµĞ½Ñ‚ÑĞºĞ¾Ğ¹ Ñ‡Ğ°ÑÑ‚Ğ¸
cd web/html-css-js-client
npm install
npm run build  # Ğ¡Ğ¾Ğ±ĞµÑ€ĞµÑ‚ Ğ² static/client/
```

### Admin panel usage
- ğŸ‘¤ ĞĞ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ĞµĞ¹ Ğ¸ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ²
- ğŸ“¦ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°Ğ¼Ğ¸
  - ĞŸÑ€Ğ¾ÑĞ¼Ğ¾Ñ‚Ñ€ ÑĞ¿Ğ¸ÑĞºĞ° Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
  - Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
  - Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ÑƒÑÑ‰Ğ¸Ñ… Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²
- ğŸ–¼ï¸ Ğ£Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ·Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸ÑĞ¼Ğ¸
- ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ·Ğ°ÑĞ²Ğ¾Ğº
- ğŸ¨ Ğ¡Ğ¾Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğ¹ Ğ°Ğ´Ğ°Ğ¿Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ Ğ´Ğ¸Ğ·Ğ°Ğ¹Ğ½
- ğŸš€ ĞœĞ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ½Ğ°Ñ Ğ°Ñ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ğ´Ğ»Ñ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ¸Ñ€ÑƒĞµĞ¼Ğ¾ÑÑ‚Ğ¸

## ğŸ§ª Testing

Ğ’ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ÑÑ Ğ´Ğ²Ğ° Ñ‚Ğ¸Ğ¿Ğ° Ñ‚ĞµÑÑ‚Ğ¾Ğ² (Ğ² Ğ½Ğ°ÑÑ‚Ğ¾ÑÑ‰ĞµĞµ Ğ²Ñ€ĞµĞ¼Ñ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ğ½Ñ‹ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ° Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸):

### Unit Tests
ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑÑ‚ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹ Ğ² Ğ¸Ğ·Ğ¾Ğ»ÑÑ†Ğ¸Ğ¸, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑ Ğ¼Ğ¾ĞºĞ¸ Ğ´Ğ»Ñ Ğ¸Ğ¼Ğ¸Ñ‚Ğ°Ñ†Ğ¸Ğ¸ Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹.
ĞĞ°Ñ…Ğ¾Ğ´ÑÑ‚ÑÑ Ğ² Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ÑÑ… `internal/auth/usecase` Ğ¸ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑÑÑ‚ Ğ±Ğ¸Ğ·Ğ½ĞµÑ-Ğ»Ğ¾Ğ³Ğ¸ĞºÑƒ ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².

### Integration Tests
ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑÑÑ‚ Ğ²Ğ·Ğ°Ğ¸Ğ¼Ğ¾Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ğµ Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ñ‹Ğ¼Ğ¸ Ğ²Ğ½ĞµÑˆĞ½Ğ¸Ğ¼Ğ¸ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ°Ğ¼Ğ¸ (PostgreSQL).
ĞĞ°Ñ…Ğ¾Ğ´ÑÑ‚ÑÑ Ğ² Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸ÑÑ… `internal/auth/repository/postgres` Ğ¸ Ñ‚Ñ€ĞµĞ±ÑƒÑÑ‚ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ‚ĞµÑÑ‚Ğ¾Ğ²Ğ¾Ğ¹ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… `auth_test`.

```bash
# Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ²ÑĞµÑ… Ñ‚ĞµÑÑ‚Ğ¾Ğ²
make test

# Ğ—Ğ°Ğ¿ÑƒÑĞº Ñ‚ĞµÑÑ‚Ğ¾Ğ² Ğ´Ğ»Ñ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ°
make test-auth
make test-auth-unit      # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¼Ğ¾Ğ´ÑƒĞ»ÑŒĞ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸
make test-auth-integration # Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ğ¾Ğ½Ğ½Ñ‹Ğµ Ñ‚ĞµÑÑ‚Ñ‹ Ğ°Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸


## ğŸ“Š Monitoring

ĞŸÑ€Ğ¾ĞµĞºÑ‚ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½ Ñ Prometheus Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ° Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ÑÑ‚Ğ¸ Ğ¸ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¼Ğ¸ĞºÑ€Ğ¾ÑĞµÑ€Ğ²Ğ¸ÑĞ¾Ğ².

## ğŸ“œ Migrations

Ğ”Ğ»Ñ ÑƒĞ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸ÑĞ¼Ğ¸ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ ÑƒÑ‚Ğ¸Ğ»Ğ¸Ñ‚Ğ° [golang-migrate](https://github.com/golang-migrate/migrate). ĞšĞ°Ğ¶Ğ´Ğ°Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ ÑĞ¾ÑÑ‚Ğ¾Ğ¸Ñ‚ Ğ¸Ğ· Ğ´Ğ²ÑƒÑ… Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ²: Ğ¿Ñ€ÑĞ¼Ğ¾Ğ¹ (up) Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ñ‚Ğ½Ğ¾Ğ¹ (down) Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸.

```bash
# Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚ Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
1481574547_create_users_table.up.sql   
1481574547_create_users_table.down.sql
```

### Commands for working with migrations

```bash
# Create database
make create-db SERVICE=auth    
make create-db SERVICE=product

# Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…
make drop-db SERVICE=auth     
make drop-db SERVICE=product 

# Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¸
make migrate-create SERVICE=auth   
make migrate-create SERVICE=product

# ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
make migrate-up SERVICE=auth   
make migrate-up SERVICE=product

# ĞÑ‚ĞºĞ°Ñ‚ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
make migrate-down SERVICE=auth   
make migrate-down SERVICE=product

# Ğ¡Ğ±Ñ€Ğ¾Ñ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
make migrate-clean SERVICE=auth   
make migrate-clean SERVICE=product 

# Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ¹ Ğ²ĞµÑ€ÑĞ¸Ğ¸ Ğ¼Ğ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ğ¹
make migrate-force SERVICE=auth VERSION=1
```

---
